<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SEO Keyword Expander (Raw vs Semantic)</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #fafafa;
      color: #333;
    }
    h1 { text-align: center; margin-bottom: 5px; }
    .subtitle { text-align: center; color: #666; margin-bottom: 20px; }
    label { display: block; margin: 15px 0 8px 0; font-weight: 600; }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    textarea { min-height: 80px; resize: vertical; }
    .checkbox-group {
      margin: 15px 0;
    }
    .checkbox-group label {
      display: inline-flex;
      align-items: center;
      font-weight: normal;
      margin-right: 20px;
    }
    button {
      background: #4285f4;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover:not(:disabled) { background: #3367d6; }
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    .tables-container {
      display: flex;
      gap: 20px;
      margin-top: 25px;
      flex-wrap: wrap;
    }
    .table-panel {
      flex: 1;
      min-width: 300px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .table-header {
      padding: 10px 15px;
      background: #f5f5f5;
      font-weight: 600;
      border-bottom: 1px solid #ddd;
    }
    .table-content {
      max-height: 400px;
      overflow: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th, td {
      border: 1px solid #eee;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background-color: #f9f9f9;
    }
    .status {
      margin-top: 10px;
      color: #d32f2f;
      font-style: italic;
    }
    .success {
      color: #2e7d32 !important;
    }
  </style>
</head>
<body>
  <h1>ğŸ” SEO Keyword Expander (Raw vs Semantic)</h1>
  <div class="subtitle">Multilingual keyword expansion with flexible alphabet control</div>

  <label for="seed">Seed Keyword (e.g., "seo")</label>
  <input type="text" id="seed" placeholder="seo" value="seo" />

  <label for="language">Language (hl)</label>
  <select id="language">
    <option value="en">English</option>
    <option value="es">EspaÃ±ol</option>
    <option value="fr">FranÃ§ais</option>
    <option value="de">Deutsch</option>
    <option value="pt">PortuguÃªs</option>
    <option value="it">Italiano</option>
    <option value="nl">Nederlands</option>
    <option value="pl">Polski</option>
    <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
    <option value="ja">æ—¥æœ¬èª</option>
    <option value="ko">í•œêµ­ì–´</option>
    <option value="zh">ä¸­æ–‡</option>
    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
    <option value="bn">à¦¬à¦¾à¦‚à¦²à¦¾</option>
    <option value="tr">TÃ¼rkÃ§e</option>
    <option value="th">à¹„à¸—à¸¢</option>
    <option value="vi">Tiáº¿ng Viá»‡t</option>
    <option value="id">Bahasa Indonesia</option>
    <option value="ms">Bahasa Melayu</option>
    <option value="fa">ÙØ§Ø±Ø³ÛŒ</option>
    <option value="uk">Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</option>
    <option value="el">Î•Î»Î»Î·Î½Î¹ÎºÎ¬</option>
    <option value="cs">ÄŒeÅ¡tina</option>
    <option value="sv">Svenska</option>
    <option value="da">Dansk</option>
    <option value="fi">Suomi</option>
    <option value="no">Norsk</option>
    <option value="he">×¢×‘×¨×™×ª</option>
    <option value="ro">RomÃ¢nÄƒ</option>
    <option value="hu">Magyar</option>
    <option value="sk">SlovenÄina</option>
    <option value="hr">Hrvatski</option>
    <option value="sr">Ğ¡Ñ€Ğ¿ÑĞºĞ¸</option>
    <option value="bg">Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸</option>
    <option value="lt">LietuviÅ³</option>
    <option value="lv">LatvieÅ¡u</option>
    <option value="et">Eesti</option>
    <option value="sl">SlovenÅ¡Äina</option>
    <option value="ca">CatalÃ </option>
    <option value="eu">Euskara</option>
    <option value="gl">Galego</option>
    <option value="ta">à®¤à®®à®¿à®´à¯</option>
    <option value="te">à°¤à±†à°²à±à°—à±</option>
    <option value="mr">à¤®à¤°à¤¾à¤ à¥€</option>
    <option value="ur">Ø§Ø±Ø¯Ùˆ</option>
    <option value="sw">Kiswahili</option>
    <option value="fil">Filipino</option>
  </select>

  <label for="country">Country/Region (gl)</label>
  <select id="country">
    <option value="US">United States</option>
    <option value="GB">United Kingdom</option>
    <option value="CA">Canada</option>
    <option value="AU">Australia</option>
    <option value="IN">India</option>
    <option value="BD">Bangladesh</option>
    <option value="DE">Germany</option>
    <option value="FR">France</option>
    <option value="ES">Spain</option>
    <option value="IT">Italy</option>
    <option value="BR">Brazil</option>
    <option value="MX">Mexico</option>
    <option value="AR">Argentina</option>
    <option value="CL">Chile</option>
    <option value="CO">Colombia</option>
    <option value="PE">Peru</option>
    <option value="VE">Venezuela</option>
    <option value="ZA">South Africa</option>
    <option value="NG">Nigeria</option>
    <option value="EG">Egypt</option>
    <option value="SA">Saudi Arabia</option>
    <option value="AE">United Arab Emirates</option>
    <option value="TR">Turkey</option>
    <option value="RU">Russia</option>
    <option value="UA">Ukraine</option>
    <option value="JP">Japan</option>
    <option value="KR">South Korea</option>
    <option value="CN">China</option>
    <option value="SG">Singapore</option>
    <option value="MY">Malaysia</option>
    <option value="TH">Thailand</option>
    <option value="VN">Vietnam</option>
    <option value="PH">Philippines</option>
    <option value="ID">Indonesia</option>
    <option value="NZ">New Zealand</option>
    <option value="IE">Ireland</option>
    <option value="CH">Switzerland</option>
    <option value="SE">Sweden</option>
    <option value="NO">Norway</option>
    <option value="DK">Denmark</option>
    <option value="FI">Finland</option>
    <option value="PL">Poland</option>
    <option value="CZ">Czech Republic</option>
    <option value="HU">Hungary</option>
    <option value="RO">Romania</option>
    <option value="BG">Bulgaria</option>
    <option value="GR">Greece</option>
    <option value="PT">Portugal</option>
    <option value="IL">Israel</option>
    <option value="PK">Pakistan</option>
    <option value="LK">Sri Lanka</option>
    <option value="NP">Nepal</option>
    <option value="MM">Myanmar</option>
    <option value="KH">Cambodia</option>
    <option value="LA">Laos</option>
    <option value="KE">Kenya</option>
    <option value="GH">Ghana</option>
    <option value="TZ">Tanzania</option>
    <option value="UG">Uganda</option>
    <option value="DZ">Algeria</option>
    <option value="MA">Morocco</option>
    <option value="TN">Tunisia</option>
    <option value="QA">Qatar</option>
    <option value="KW">Kuwait</option>
    <option value="OM">Oman</option>
    <option value="BH">Bahrain</option>
    <option value="JO">Jordan</option>
    <option value="LB">Lebanon</option>
    <option value="IQ">Iraq</option>
    <option value="IR">Iran</option>
    <option value="AF">Afghanistan</option>
  </select>

  <label>Custom Prefixes (one per line)</label>
  <textarea id="customPrefixes" placeholder="best&#10;top"></textarea>

  <label>Custom Suffixes (one per line)</label>
  <textarea id="customSuffixes" placeholder="tools&#10;meaning"></textarea>

  <div class="checkbox-group">
    <label><input type="checkbox" id="includeAlphabet" checked> Include alphabet variations</label>
    <label><input type="checkbox" id="includeSpace"> Space variants</label>
    <label><input type="checkbox" id="latinOnlyOverride"> Use selected language only (exclude English alphabet)</label>
    <label><input type="checkbox" id="semanticFilter"> Use Semantic Relevance Filter</label>
  </div>

  <button id="startBtn">Generate & Fetch All</button>
  <div class="status" id="status"></div>

  <div class="tables-container">
    <div class="table-panel">
      <div class="table-header">Raw Suggestions (No Filter)</div>
      <div class="table-content" id="rawResults"></div>
    </div>
    <div class="table-panel">
      <div class="table-header">Semantic Filtered (Relevant Only)</div>
      <div class="table-content" id="filteredResults"></div>
    </div>
  </div>

  <button id="copyRawBtn" style="display:none; margin-top:15px;">ğŸ“‹ Copy Raw for Google Sheets</button>
  <button id="copyBtn" style="display:none; margin-top:10px;">ğŸ“‹ Copy Filtered for Google Sheets</button>

  <script>
    // ====== ALPHABETS: Dynamic based on language + override flag ======
    function getAlphabetForLanguage(hl, excludeEnglish = false) {
      const english = 'abcdefghijklmnopqrstuvwxyz';

      // If "language only" is selected, skip English unless hl === 'en'
      if (excludeEnglish) {
        if (hl === 'en') return english; // English-only when selected

        const nativeOnly = {
          bn: 'à¦…à¦†à¦‡à¦ˆà¦‰à¦Šà¦‹à¦à¦à¦“à¦”à¦•à¦–à¦—à¦˜à¦™à¦šà¦›à¦œà¦à¦à¦Ÿà¦ à¦¡à¦¢à¦£à¦¤à¦¥à¦¦à¦§à¦¨à¦ªà¦«à¦¬à¦­à¦®à¦¯à¦°à¦²à¦¶à¦·à¦¸à¦¹à¦¡à¦¼à¦¢à¦¼à¦¯à¦¼à§',
          hi: 'à¤…à¤†à¤‡à¤ˆà¤‰à¤Šà¤‹à¤à¤à¤“à¤”à¤•à¤–à¤—à¤˜à¤™à¤šà¤›à¤œà¤à¤à¤Ÿà¤ à¤¡à¤¢à¤£à¤¤à¤¥à¤¦à¤§à¤¨à¤ªà¤«à¤¬à¤­à¤®à¤¯à¤°à¤²à¤µà¤¶à¤·à¤¸à¤¹',
          mr: 'à¤…à¤†à¤‡à¤ˆà¤‰à¤Šà¤‹à¤à¤à¤“à¤”à¤•à¤–à¤—à¤˜à¤™à¤šà¤›à¤œà¤à¤à¤Ÿà¤ à¤¡à¤¢à¤£à¤¤à¤¥à¤¦à¤§à¤¨à¤ªà¤«à¤¬à¤­à¤®à¤¯à¤°à¤²à¤µà¤¶à¤·à¤¸à¤¹',
          ne: 'à¤…à¤†à¤‡à¤ˆà¤‰à¤Šà¤‹à¤à¤à¤“à¤”à¤•à¤–à¤—à¤˜à¤™à¤šà¤›à¤œà¤à¤à¤Ÿà¤ à¤¡à¤¢à¤£à¤¤à¤¥à¤¦à¤§à¤¨à¤ªà¤«à¤¬à¤­à¤®à¤¯à¤°à¤²à¤µà¤¶à¤·à¤¸à¤¹',
          ar: 'Ø§Ø¨ØªØ¬Ø­Ø¯Ø®Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡ÙˆÙŠØ¢Ø©Ù‰',
          ru: 'Ğ°Ğ±Ğ²Ğ³Ğ´ĞµÑ‘Ğ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ',
          uk: 'Ğ°Ğ±Ğ²Ğ³Ò‘Ğ´ĞµÑ”Ğ¶Ğ·Ğ¸Ñ–Ñ—Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŒÑÑ',
          bg: 'Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑŒÑÑ',
          ko: 'ê°€ë‚˜ë‹¤ë¼ë§ˆë°”ì‚¬ì•„ìì°¨ì¹´íƒ€íŒŒí•˜ê±°ë„ˆë”ëŸ¬ë¨¸ë²„ì„œì–´ì €ì²˜ì»¤í„°í¼í—ˆê³ ë…¸ë„ë¡œëª¨ë³´ì†Œì˜¤ì¡°ì´ˆì½”í† í¬í˜¸',
          ja: 'ã‚ã„ã†ãˆãŠã‹ããã‘ã“ã•ã—ã™ã›ããŸã¡ã¤ã¦ã¨ãªã«ã¬ã­ã®ã¯ã²ãµã¸ã»ã¾ã¿ã‚€ã‚ã‚‚ã‚„ã‚†ã‚ˆã‚‰ã‚Šã‚‹ã‚Œã‚ã‚ã‚’ã‚“ãŒããã’ã”ã–ã˜ãšãœãã ã¢ã¥ã§ã©ã°ã³ã¶ã¹ã¼ã±ã´ã·ãºã½',
          el: 'Î±Î²Î³Î´ÎµÎ¶Î·Î¸Î¹ÎºÎ»Î¼Î½Î¾Î¿Ï€ÏÏƒÏ„Ï…Ï†Ï‡ÏˆÏ‰',
          he: '××‘×’×“×”×•×–×—×˜×™×›×œ×× ×¡×¢×¤×¦×§×¨×©×ª',
          ta: 'à®…à®†à®‡à®ˆà®‰à®Šà®à®à®à®’à®“à®”à®•à®™à®šà®œà®à®Ÿà®£à®¤à®¨à®©à®ªà®®à®¯à®°à®±à®²à®³à®´à®µà®·à®¸à®¹',
          te: 'à°…à°†à°‡à°ˆà°‰à°Šà°‹à°à°à°à°’à°“à°”à°•à°–à°—à°˜à°™à°šà°›à°œà°à°à°Ÿà° à°¡à°¢à°£à°¤à°¥à°¦à°§à°¨à°ªà°«à°¬à°­à°®à°¯à°°à°±à°²à°³à°µà°¶à°·à°¸à°¹',
          ur: 'Ø§Ø¨Ù¾ØªØ«Ø¬Ú†Ø­Ø®Ø¯Ø°Ø±Ú‘Ø²Ú˜Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚Ú©Ú¯Ù„Ù…Ù†ÙˆÛÚ¾ÛŒÛ’',
          // For Latin-script languages, return empty (since English covers it)
          es: '', fr: '', de: '', pt: '', it: '', nl: '', pl: '', tr: '',
          id: '', ms: '', vi: '', th: '', fil: '', ca: '', eu: '', gl: '', sw: '',
          // Chinese: no alphabet
          zh: ''
        };
        return nativeOnly[hl] || english; // fallback to English if unknown
      }

      // Default: English + native
      const nativeAlphabets = {
        bn: 'à¦…à¦†à¦‡à¦ˆà¦‰à¦Šà¦‹à¦à¦à¦“à¦”à¦•à¦–à¦—à¦˜à¦™à¦šà¦›à¦œà¦à¦à¦Ÿà¦ à¦¡à¦¢à¦£à¦¤à¦¥à¦¦à¦§à¦¨à¦ªà¦«à¦¬à¦­à¦®à¦¯à¦°à¦²à¦¶à¦·à¦¸à¦¹à¦¡à¦¼à¦¢à¦¼à¦¯à¦¼à§',
        hi: 'à¤…à¤†à¤‡à¤ˆà¤‰à¤Šà¤‹à¤à¤à¤“à¤”à¤•à¤–à¤—à¤˜à¤™à¤šà¤›à¤œà¤à¤à¤Ÿà¤ à¤¡à¤¢à¤£à¤¤à¤¥à¤¦à¤§à¤¨à¤ªà¤«à¤¬à¤­à¤®à¤¯à¤°à¤²à¤µà¤¶à¤·à¤¸à¤¹',
        mr: 'à¤…à¤†à¤‡à¤ˆà¤‰à¤Šà¤‹à¤à¤à¤“à¤”à¤•à¤–à¤—à¤˜à¤™à¤šà¤›à¤œà¤à¤à¤Ÿà¤ à¤¡à¤¢à¤£à¤¤à¤¥à¤¦à¤§à¤¨à¤ªà¤«à¤¬à¤­à¤®à¤¯à¤°à¤²à¤µà¤¶à¤·à¤¸à¤¹',
        ne: 'à¤…à¤†à¤‡à¤ˆà¤‰à¤Šà¤‹à¤à¤à¤“à¤”à¤•à¤–à¤—à¤˜à¤™à¤šà¤›à¤œà¤à¤à¤Ÿà¤ à¤¡à¤¢à¤£à¤¤à¤¥à¤¦à¤§à¤¨à¤ªà¤«à¤¬à¤­à¤®à¤¯à¤°à¤²à¤µà¤¶à¤·à¤¸à¤¹',
        ar: 'Ø§Ø¨ØªØ¬Ø­Ø¯Ø®Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡ÙˆÙŠØ¢Ø©Ù‰',
        ru: 'Ğ°Ğ±Ğ²Ğ³Ğ´ĞµÑ‘Ğ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ',
        uk: 'Ğ°Ğ±Ğ²Ğ³Ò‘Ğ´ĞµÑ”Ğ¶Ğ·Ğ¸Ñ–Ñ—Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŒÑÑ',
        bg: 'Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑŒÑÑ',
        ko: 'ê°€ë‚˜ë‹¤ë¼ë§ˆë°”ì‚¬ì•„ìì°¨ì¹´íƒ€íŒŒí•˜ê±°ë„ˆë”ëŸ¬ë¨¸ë²„ì„œì–´ì €ì²˜ì»¤í„°í¼í—ˆê³ ë…¸ë„ë¡œëª¨ë³´ì†Œì˜¤ì¡°ì´ˆì½”í† í¬í˜¸',
        ja: 'ã‚ã„ã†ãˆãŠã‹ããã‘ã“ã•ã—ã™ã›ããŸã¡ã¤ã¦ã¨ãªã«ã¬ã­ã®ã¯ã²ãµã¸ã»ã¾ã¿ã‚€ã‚ã‚‚ã‚„ã‚†ã‚ˆã‚‰ã‚Šã‚‹ã‚Œã‚ã‚ã‚’ã‚“ãŒããã’ã”ã–ã˜ãšãœãã ã¢ã¥ã§ã©ã°ã³ã¶ã¹ã¼ã±ã´ã·ãºã½',
        el: 'Î±Î²Î³Î´ÎµÎ¶Î·Î¸Î¹ÎºÎ»Î¼Î½Î¾Î¿Ï€ÏÏƒÏ„Ï…Ï†Ï‡ÏˆÏ‰',
        he: '××‘×’×“×”×•×–×—×˜×™×›×œ×× ×¡×¢×¤×¦×§×¨×©×ª',
        ta: 'à®…à®†à®‡à®ˆà®‰à®Šà®à®à®à®’à®“à®”à®•à®™à®šà®œà®à®Ÿà®£à®¤à®¨à®©à®ªà®®à®¯à®°à®±à®²à®³à®´à®µà®·à®¸à®¹',
        te: 'à°…à°†à°‡à°ˆà°‰à°Šà°‹à°à°à°à°’à°“à°”à°•à°–à°—à°˜à°™à°šà°›à°œà°à°à°Ÿà° à°¡à°¢à°£à°¤à°¥à°¦à°§à°¨à°ªà°«à°¬à°­à°®à°¯à°°à°±à°²à°³à°µà°¶à°·à°¸à°¹',
        ur: 'Ø§Ø¨Ù¾ØªØ«Ø¬Ú†Ø­Ø®Ø¯Ø°Ø±Ú‘Ø²Ú˜Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚Ú©Ú¯Ù„Ù…Ù†ÙˆÛÚ¾ÛŒÛ’',
        es: '', fr: '', de: '', pt: '', it: '', nl: '', pl: '', tr: '',
        id: '', ms: '', vi: '', th: '', fil: '', ca: '', eu: '', gl: '', sw: '',
        zh: ''
      };

      const native = nativeAlphabets[hl] || '';
      return english + native;
    }

    // ====== Utility Functions ======
    function cleanSuggestion(str) {
      return str.replace(/\\u003c/g, '<').replace(/\\u003e/g, '>').replace(/<\/?b>/g, '');
    }

    function cosineSimilarity(a, b) {
      let dot = 0, normA = 0, normB = 0;
      for (let i = 0; i < a.length; i++) {
        dot += a[i] * b[i];
        normA += a[i] * a[i];
        normB += b[i] * b[i];
      }
      return dot / (Math.sqrt(normA) * Math.sqrt(normB));
    }

    // ====== Fetch Google Suggestions ======
    async function fetchSuggestions(query, hl, gl) {
      const callback = `jQuery37108808087974703922_${Date.now()}`;
      const params = new URLSearchParams({
        q: query, hl, gl, xhr: '0', client: 'psy-ab', callback, _: Date.now()
      });
      const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(`https://www.google.com/complete/search?${params}`)}`;
      try {
        const res = await fetch(proxyUrl, {
          headers: {
            'Accept': '*/*',
            'Accept-Language': `${hl}-${gl},en;q=0.9`,
            'User-Agent': 'Mozilla/5.0 (Linux; Android 10) AppleWebKit/537.36'
          }
        });
        const text = await res.text();
        const match = text.match(new RegExp(`${callback}\\((.*)\\)`));
        if (!match) return [];
        const data = JSON.parse(match[1]);
        return (data[1] || []).map(item => cleanSuggestion(item[0]));
      } catch (e) {
        return [];
      }
    }

    // ====== Generate Keyword Variants ======
    function generateKeywordVariants(seed, hl) {
      const v = [{ query: seed, prefix: '', suffix: '' }];
      
      if (document.getElementById('includeSpace').checked) {
        v.push({ query: ` ${seed}`, prefix: '(space)', suffix: '' });
        v.push({ query: `${seed} `, prefix: '', suffix: '(space)' });
      }

      if (document.getElementById('includeAlphabet').checked) {
        const excludeEnglish = document.getElementById('latinOnlyOverride').checked;
        const chars = getAlphabetForLanguage(hl, excludeEnglish);
        for (const char of chars) {
          v.push({ query: `${char} ${seed}`, prefix: char, suffix: '' });
          v.push({ query: `${seed} ${char}`, prefix: '', suffix: char });
        }
      }

      ['customPrefixes', 'customSuffixes'].forEach((id, isSuffix) => {
        document.getElementById(id).value.split('\n').map(s => s.trim()).filter(s => s)
          .forEach(term => {
            v.push({
              query: isSuffix ? `${seed} ${term}` : `${term} ${seed}`,
              prefix: isSuffix ? '' : term,
              suffix: isSuffix ? term : ''
            });
          });
      });
      return v;
    }

    // ====== Render Table ======
    function renderTable(container, rows) {
      if (rows.length === 0) {
        container.innerHTML = '<div style="padding:15px;color:#888;">No data</div>';
        return;
      }
      const html = `
        <table>
          <thead><tr><th>prefix</th><th>suffix</th><th>query</th></tr></thead>
          <tbody>
            ${rows.map(r => `<tr><td>${r[0] || '&nbsp;'}</td><td>${r[1] || '&nbsp;'}</td><td>${r[2]}</td></tr>`).join('')}
          </tbody>
        </table>
      `;
      container.innerHTML = html;
    }

    // ====== Copy to Clipboard ======
    function copyToClipboard(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text);
      } else {
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed'; ta.style.left = '-999999px';
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
      }
    }

    // ====== Main Logic ======
    document.getElementById('startBtn').addEventListener('click', async () => {
      const seed = document.getElementById('seed').value.trim();
      const hl = document.getElementById('language').value;
      const gl = document.getElementById('country').value;
      const useSemantic = document.getElementById('semanticFilter').checked;

      if (!seed) return alert('Enter seed keyword');

      const btn = document.getElementById('startBtn');
      const statusEl = document.getElementById('status');
      const rawEl = document.getElementById('rawResults');
      const filteredEl = document.getElementById('filteredResults');
      const copyBtn = document.getElementById('copyBtn');
      const copyRawBtn = document.getElementById('copyRawBtn');

      btn.disabled = true;
      statusEl.textContent = 'Generating variants...';
      rawEl.innerHTML = '<div style="padding:15px;">Loading...</div>';
      filteredEl.innerHTML = '<div style="padding:15px;">Loading...</div>';
      copyBtn.style.display = 'none';
      copyRawBtn.style.display = 'none';

      const variants = generateKeywordVariants(seed, hl);
      statusEl.textContent = `Fetching ${variants.length} queries (${hl}/${gl})...`;

      const allRawRows = [['prefix', 'suffix', 'query']];
      for (let i = 0; i < variants.length; i++) {
        const { query, prefix, suffix } = variants[i];
        const suggestions = await fetchSuggestions(query, hl, gl);
        suggestions.forEach(s => allRawRows.push([prefix, suffix, s]));
        statusEl.textContent = `Fetched ${i + 1}/${variants.length}: "${query}"`;
        await new Promise(r => setTimeout(r, 200));
      }

      const seen = new Set();
      const uniqueRaw = allRawRows.filter(row => {
        if (!seen.has(row[2])) {
          seen.add(row[2]);
          return true;
        }
        return false;
      });

      renderTable(rawEl, uniqueRaw.slice(1));
      
      const rawTsv = uniqueRaw.map(r => 
        r.map(f => `"${String(f).replace(/"/g, '""')}"`).join('\t')
      ).join('\n');

      copyRawBtn.onclick = () => {
        copyToClipboard(rawTsv);
        const orig = copyRawBtn.textContent;
        copyRawBtn.textContent = 'âœ… Copied Raw!';
        setTimeout(() => copyRawBtn.textContent = orig, 2000);
      };
      copyRawBtn.style.display = 'inline-block';

      statusEl.textContent = `Raw: ${uniqueRaw.length - 1} suggestions`;

      if (useSemantic) {
        statusEl.textContent = 'Loading semantic model (one-time, ~45MB)...';
        const { pipeline } = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2');
        const encoder = await pipeline('feature-extraction', 'Xenova/all-MiniLM-L6-v2');
        statusEl.textContent = 'Computing semantic relevance...';

        const seedEmb = (await encoder(seed)).data;
        const filteredRows = [['prefix', 'suffix', 'query']];

        for (const row of uniqueRaw.slice(1)) {
          const query = row[2];
          const emb = (await encoder(query)).data;
          const sim = cosineSimilarity(Array.from(seedEmb), Array.from(emb));
          if (sim > 0.60) {
            filteredRows.push(row);
          }
        }

        renderTable(filteredEl, filteredRows.slice(1));
        statusEl.textContent = `âœ… Done! Raw: ${uniqueRaw.length - 1} | Filtered: ${filteredRows.length - 1}`;

        const tsv = filteredRows.map(r => 
          r.map(f => `"${String(f).replace(/"/g, '""')}"`).join('\t')
        ).join('\n');

        copyBtn.onclick = () => {
          copyToClipboard(tsv);
          const orig = copyBtn.textContent;
          copyBtn.textContent = 'âœ… Copied Filtered!';
          setTimeout(() => copyBtn.textContent = orig, 2000);
        };
        copyBtn.style.display = 'inline-block';
      } else {
        filteredEl.innerHTML = '<div style="padding:15px;color:#888;">Enable "Semantic Filter" to see relevant results</div>';
      }

      btn.disabled = false;
    });
  </script>
</body>
</html>
